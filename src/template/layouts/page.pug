doctype html
html(lang=siteConf.language)
  head
    title #{(siteConf.title + " " + (pageConf.title || "")).trim()}
    meta(name="description" content=pageConf.description || siteConf.description || "")
    meta(name="keywords" content=[...(pageConf.keywords || []), ...(siteConf.keywords || [])].join(", "))
    meta(name="author" content=siteConf.author)
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    meta(http-equiv="Content-Security-Policy" content=csp)
    meta(name="robots" content=(siteConf.allowRobots && (pageConf.allowRobots || false) ? "nofollow, noarchive, nositelinkssearchbox, notranslate" : "none"))
    | !{faviconHtml}
    style
      each fontKey in ["logo", "head", "subhead", "bodyNorm", "bodyEmph"]
        - const font = res.fonts[fontKey]
        | @font-face {
        |   font-family: '#{fontKey}';
        |   src: #{['woff2', 'woff'].map(fmt => `url('${font[`${fmt}Url`]}') format('${fmt}')`).join(", ")};
        |   font-display: block;
        | }
    style #{res.styles.main.inline}
    noscript 
      style #{res.styles.noscript.inline}
    style #{res.styles.noscript.inline}
  body
    #loading
      #loading-content !{res.icons.loading.inline}
    main#main(role="main")
      header#header
        a(href='/')
          h1#logo #{text("logo", siteConf.title.toLowerCase())}
      section#pages
        ul
          each page in pages
            li.page
              header.header
                a.link(href=page.conf.url)
                  h2.title #{text("head", page.conf.title)}
                  if page.conf.subtitle
                    h3.subtitle #{text("subhead", page.conf.subtitle)}
                  if page.conf.date
                    .date #{new Date(page.conf.date).toLocaleDateString("it-IT", { year: 'numeric', month: 'long', day: 'numeric' })}
              if page.bodyHtml 
                | !{page.bodyHtml}
      footer#footer
        #author #{text("logo", siteConf.author)}
  script(src=res.scripts.main.url)
  if devScript !== null
    script
      | !{devScript}